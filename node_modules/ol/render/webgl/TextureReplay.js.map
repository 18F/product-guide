{"version":3,"file":"TextureReplay.js","sources":["../../../../src/ol/render/webgl/TextureReplay.js"],"sourcesContent":["/**\n * @module ol/render/webgl/TextureReplay\n */\nimport {abstract, getUid} from '../../util.js';\nimport {intersects} from '../../extent.js';\nimport {isEmpty} from '../../obj.js';\nimport {fragment, vertex} from './texturereplay/defaultshader.js';\nimport Locations from './texturereplay/defaultshader/Locations.js';\nimport WebGLReplay from './Replay.js';\nimport {CLAMP_TO_EDGE, FLOAT, TEXTURE_2D} from '../../webgl.js';\nimport {createTexture} from '../../webgl/Context.js';\n\nclass WebGLTextureReplay extends WebGLReplay {\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Max extent.\n   */\n  constructor(tolerance, maxExtent) {\n    super(tolerance, maxExtent);\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.anchorX = undefined;\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.anchorY = undefined;\n\n    /**\n     * @type {Array<number>}\n     * @protected\n     */\n    this.groupIndices = [];\n\n    /**\n     * @type {Array<number>}\n     * @protected\n     */\n    this.hitDetectionGroupIndices = [];\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.height = undefined;\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.imageHeight = undefined;\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.imageWidth = undefined;\n\n    /**\n     * @protected\n     * @type {import(\"./texturereplay/defaultshader/Locations.js\").default}\n     */\n    this.defaultLocations = null;\n\n    /**\n     * @protected\n     * @type {number|undefined}\n     */\n    this.opacity = undefined;\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.originX = undefined;\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.originY = undefined;\n\n    /**\n     * @protected\n     * @type {boolean|undefined}\n     */\n    this.rotateWithView = undefined;\n\n    /**\n     * @protected\n     * @type {number|undefined}\n     */\n    this.rotation = undefined;\n\n    /**\n     * @protected\n     * @type {number|undefined}\n     */\n    this.scale = undefined;\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.width = undefined;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getDeleteResourcesFunction(context) {\n    const verticesBuffer = this.verticesBuffer;\n    const indicesBuffer = this.indicesBuffer;\n    const textures = this.getTextures(true);\n    const gl = context.getGL();\n    return function() {\n      if (!gl.isContextLost()) {\n        let i, ii;\n        for (i = 0, ii = textures.length; i < ii; ++i) {\n          gl.deleteTexture(textures[i]);\n        }\n      }\n      context.deleteBuffer(verticesBuffer);\n      context.deleteBuffer(indicesBuffer);\n    };\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {number} end End.\n   * @param {number} stride Stride.\n   * @return {number} My end.\n   * @protected\n   */\n  drawCoordinates(flatCoordinates, offset, end, stride) {\n    const anchorX = /** @type {number} */ (this.anchorX);\n    const anchorY = /** @type {number} */ (this.anchorY);\n    const height = /** @type {number} */ (this.height);\n    const imageHeight = /** @type {number} */ (this.imageHeight);\n    const imageWidth = /** @type {number} */ (this.imageWidth);\n    const opacity = /** @type {number} */ (this.opacity);\n    const originX = /** @type {number} */ (this.originX);\n    const originY = /** @type {number} */ (this.originY);\n    const rotateWithView = this.rotateWithView ? 1.0 : 0.0;\n    // this.rotation_ is anti-clockwise, but rotation is clockwise\n    const rotation = /** @type {number} */ (-this.rotation);\n    const scale = /** @type {number} */ (this.scale);\n    const width = /** @type {number} */ (this.width);\n    const cos = Math.cos(rotation);\n    const sin = Math.sin(rotation);\n    let numIndices = this.indices.length;\n    let numVertices = this.vertices.length;\n    let i, n, offsetX, offsetY, x, y;\n    for (i = offset; i < end; i += stride) {\n      x = flatCoordinates[i] - this.origin[0];\n      y = flatCoordinates[i + 1] - this.origin[1];\n\n      // There are 4 vertices per [x, y] point, one for each corner of the\n      // rectangle we're going to draw. We'd use 1 vertex per [x, y] point if\n      // WebGL supported Geometry Shaders (which can emit new vertices), but that\n      // is not currently the case.\n      //\n      // And each vertex includes 8 values: the x and y coordinates, the x and\n      // y offsets used to calculate the position of the corner, the u and\n      // v texture coordinates for the corner, the opacity, and whether the\n      // the image should be rotated with the view (rotateWithView).\n\n      n = numVertices / 8;\n\n      // bottom-left corner\n      offsetX = -scale * anchorX;\n      offsetY = -scale * (height - anchorY);\n      this.vertices[numVertices++] = x;\n      this.vertices[numVertices++] = y;\n      this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\n      this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\n      this.vertices[numVertices++] = originX / imageWidth;\n      this.vertices[numVertices++] = (originY + height) / imageHeight;\n      this.vertices[numVertices++] = opacity;\n      this.vertices[numVertices++] = rotateWithView;\n\n      // bottom-right corner\n      offsetX = scale * (width - anchorX);\n      offsetY = -scale * (height - anchorY);\n      this.vertices[numVertices++] = x;\n      this.vertices[numVertices++] = y;\n      this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\n      this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\n      this.vertices[numVertices++] = (originX + width) / imageWidth;\n      this.vertices[numVertices++] = (originY + height) / imageHeight;\n      this.vertices[numVertices++] = opacity;\n      this.vertices[numVertices++] = rotateWithView;\n\n      // top-right corner\n      offsetX = scale * (width - anchorX);\n      offsetY = scale * anchorY;\n      this.vertices[numVertices++] = x;\n      this.vertices[numVertices++] = y;\n      this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\n      this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\n      this.vertices[numVertices++] = (originX + width) / imageWidth;\n      this.vertices[numVertices++] = originY / imageHeight;\n      this.vertices[numVertices++] = opacity;\n      this.vertices[numVertices++] = rotateWithView;\n\n      // top-left corner\n      offsetX = -scale * anchorX;\n      offsetY = scale * anchorY;\n      this.vertices[numVertices++] = x;\n      this.vertices[numVertices++] = y;\n      this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\n      this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\n      this.vertices[numVertices++] = originX / imageWidth;\n      this.vertices[numVertices++] = originY / imageHeight;\n      this.vertices[numVertices++] = opacity;\n      this.vertices[numVertices++] = rotateWithView;\n\n      this.indices[numIndices++] = n;\n      this.indices[numIndices++] = n + 1;\n      this.indices[numIndices++] = n + 2;\n      this.indices[numIndices++] = n;\n      this.indices[numIndices++] = n + 2;\n      this.indices[numIndices++] = n + 3;\n    }\n\n    return numVertices;\n  }\n\n  /**\n   * @protected\n   * @param {Array<WebGLTexture>} textures Textures.\n   * @param {Array<HTMLCanvasElement|HTMLImageElement|HTMLVideoElement>} images Images.\n   * @param {!Object<string, WebGLTexture>} texturePerImage Texture cache.\n   * @param {WebGLRenderingContext} gl Gl.\n   */\n  createTextures(textures, images, texturePerImage, gl) {\n    let texture, image, uid, i;\n    const ii = images.length;\n    for (i = 0; i < ii; ++i) {\n      image = images[i];\n\n      uid = getUid(image);\n      if (uid in texturePerImage) {\n        texture = texturePerImage[uid];\n      } else {\n        texture = createTexture(\n          gl, image, CLAMP_TO_EDGE, CLAMP_TO_EDGE);\n        texturePerImage[uid] = texture;\n      }\n      textures[i] = texture;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  setUpProgram(gl, context, size, pixelRatio) {\n    // get the program\n    const program = context.getProgram(fragment, vertex);\n\n    // get the locations\n    let locations;\n    if (!this.defaultLocations) {\n      locations = new Locations(gl, program);\n      this.defaultLocations = locations;\n    } else {\n      locations = this.defaultLocations;\n    }\n\n    // use the program (FIXME: use the return value)\n    context.useProgram(program);\n\n    // enable the vertex attrib arrays\n    gl.enableVertexAttribArray(locations.a_position);\n    gl.vertexAttribPointer(locations.a_position, 2, FLOAT,\n      false, 32, 0);\n\n    gl.enableVertexAttribArray(locations.a_offsets);\n    gl.vertexAttribPointer(locations.a_offsets, 2, FLOAT,\n      false, 32, 8);\n\n    gl.enableVertexAttribArray(locations.a_texCoord);\n    gl.vertexAttribPointer(locations.a_texCoord, 2, FLOAT,\n      false, 32, 16);\n\n    gl.enableVertexAttribArray(locations.a_opacity);\n    gl.vertexAttribPointer(locations.a_opacity, 1, FLOAT,\n      false, 32, 24);\n\n    gl.enableVertexAttribArray(locations.a_rotateWithView);\n    gl.vertexAttribPointer(locations.a_rotateWithView, 1, FLOAT,\n      false, 32, 28);\n\n    return locations;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  shutDownProgram(gl, locations) {\n    gl.disableVertexAttribArray(locations.a_position);\n    gl.disableVertexAttribArray(locations.a_offsets);\n    gl.disableVertexAttribArray(locations.a_texCoord);\n    gl.disableVertexAttribArray(locations.a_opacity);\n    gl.disableVertexAttribArray(locations.a_rotateWithView);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  drawReplay(gl, context, skippedFeaturesHash, hitDetection) {\n    const textures = hitDetection ? this.getHitDetectionTextures() : this.getTextures();\n    const groupIndices = hitDetection ? this.hitDetectionGroupIndices : this.groupIndices;\n\n    if (!isEmpty(skippedFeaturesHash)) {\n      this.drawReplaySkipping(gl, context, skippedFeaturesHash, textures, groupIndices);\n    } else {\n      let i, ii, start;\n      for (i = 0, ii = textures.length, start = 0; i < ii; ++i) {\n        gl.bindTexture(TEXTURE_2D, textures[i]);\n        const end = groupIndices[i];\n        this.drawElements(gl, context, start, end);\n        start = end;\n      }\n    }\n  }\n\n  /**\n   * Draw the replay while paying attention to skipped features.\n   *\n   * This functions creates groups of features that can be drawn to together,\n   * so that the number of `drawElements` calls is minimized.\n   *\n   * For example given the following texture groups:\n   *\n   *    Group 1: A B C\n   *    Group 2: D [E] F G\n   *\n   * If feature E should be skipped, the following `drawElements` calls will be\n   * made:\n   *\n   *    drawElements with feature A, B and C\n   *    drawElements with feature D\n   *    drawElements with feature F and G\n   *\n   * @protected\n   * @param {WebGLRenderingContext} gl gl.\n   * @param {import(\"../../webgl/Context.js\").default} context Context.\n   * @param {Object<string, boolean>} skippedFeaturesHash Ids of features\n   *  to skip.\n   * @param {Array<WebGLTexture>} textures Textures.\n   * @param {Array<number>} groupIndices Texture group indices.\n   */\n  drawReplaySkipping(gl, context, skippedFeaturesHash, textures, groupIndices) {\n    let featureIndex = 0;\n\n    let i, ii;\n    for (i = 0, ii = textures.length; i < ii; ++i) {\n      gl.bindTexture(TEXTURE_2D, textures[i]);\n      const groupStart = (i > 0) ? groupIndices[i - 1] : 0;\n      const groupEnd = groupIndices[i];\n\n      let start = groupStart;\n      let end = groupStart;\n      while (featureIndex < this.startIndices.length &&\n          this.startIndices[featureIndex] <= groupEnd) {\n        const feature = this.startIndicesFeature[featureIndex];\n\n        if (skippedFeaturesHash[getUid(feature)] !== undefined) {\n          // feature should be skipped\n          if (start !== end) {\n            // draw the features so far\n            this.drawElements(gl, context, start, end);\n          }\n          // continue with the next feature\n          start = (featureIndex === this.startIndices.length - 1) ?\n            groupEnd : this.startIndices[featureIndex + 1];\n          end = start;\n        } else {\n          // the feature is not skipped, augment the end index\n          end = (featureIndex === this.startIndices.length - 1) ?\n            groupEnd : this.startIndices[featureIndex + 1];\n        }\n        featureIndex++;\n      }\n\n      if (start !== end) {\n        // draw the remaining features (in case there was no skipped feature\n        // in this texture group, all features of a group are drawn together)\n        this.drawElements(gl, context, start, end);\n      }\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  drawHitDetectionReplayOneByOne(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {\n    let i, groupStart, start, end, feature;\n    let featureIndex = this.startIndices.length - 1;\n    const hitDetectionTextures = this.getHitDetectionTextures();\n    for (i = hitDetectionTextures.length - 1; i >= 0; --i) {\n      gl.bindTexture(TEXTURE_2D, hitDetectionTextures[i]);\n      groupStart = (i > 0) ? this.hitDetectionGroupIndices[i - 1] : 0;\n      end = this.hitDetectionGroupIndices[i];\n\n      // draw all features for this texture group\n      while (featureIndex >= 0 &&\n          this.startIndices[featureIndex] >= groupStart) {\n        start = this.startIndices[featureIndex];\n        feature = this.startIndicesFeature[featureIndex];\n\n        if (skippedFeaturesHash[getUid(feature)] === undefined &&\n            feature.getGeometry() &&\n            (opt_hitExtent === undefined || intersects(\n              /** @type {Array<number>} */ (opt_hitExtent),\n              feature.getGeometry().getExtent()))) {\n          gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n          this.drawElements(gl, context, start, end);\n\n          const result = featureCallback(feature);\n          if (result) {\n            return result;\n          }\n        }\n\n        end = start;\n        featureIndex--;\n      }\n    }\n    return undefined;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  finish(context) {\n    this.anchorX = undefined;\n    this.anchorY = undefined;\n    this.height = undefined;\n    this.imageHeight = undefined;\n    this.imageWidth = undefined;\n    this.indices = null;\n    this.opacity = undefined;\n    this.originX = undefined;\n    this.originY = undefined;\n    this.rotateWithView = undefined;\n    this.rotation = undefined;\n    this.scale = undefined;\n    this.vertices = null;\n    this.width = undefined;\n  }\n\n  /**\n   * @abstract\n   * @protected\n   * @param {boolean=} opt_all Return hit detection textures with regular ones.\n   * @return {Array<WebGLTexture>} Textures.\n   */\n  getTextures(opt_all) {\n    return abstract();\n  }\n\n  /**\n   * @abstract\n   * @protected\n   * @return {Array<WebGLTexture>} Textures.\n   */\n  getHitDetectionTextures() {\n    return abstract();\n  }\n}\n\n\nexport default WebGLTextureReplay;\n"],"names":["super","const","let"],"mappings":"AAAA;;;AAGA,QAAQ,QAAQ,EAAE,MAAM,OAAO,eAAe,CAAC;AAC/C,QAAQ,UAAU,OAAO,iBAAiB,CAAC;AAC3C,QAAQ,OAAO,OAAO,cAAc,CAAC;AACrC,QAAQ,QAAQ,EAAE,MAAM,OAAO,kCAAkC,CAAC;AAClE,OAAO,SAAS,MAAM,4CAA4C,CAAC;AACnE,OAAO,WAAW,MAAM,aAAa,CAAC;AACtC,QAAQ,aAAa,EAAE,KAAK,EAAE,UAAU,OAAO,gBAAgB,CAAC;AAChE,QAAQ,aAAa,OAAO,wBAAwB,CAAC;;AAErD,IAAM,kBAAkB,GAAoB;EAK1C,2BAAW,CAAC,SAAS,EAAE,SAAS,EAAE;IAChCA,gBAAK,OAAC,SAAS,EAAE,SAAS,CAAC,CAAC;;;;;;IAM5B,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;;;;;;IAMzB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;;;;;;IAMzB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;;;;;;IAMvB,IAAI,CAAC,wBAAwB,GAAG,EAAE,CAAC;;;;;;IAMnC,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;;;;;;IAMxB,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;;;;;;IAM7B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;;;;;;IAM5B,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;;;;;;IAM7B,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;;;;;;IAMzB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;;;;;;IAMzB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;;;;;;IAMzB,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;;;;;;IAMhC,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;;;;;;IAM1B,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;;;;;;IAMvB,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;;;;;gEACxB;;;;;+BAKD,iEAA0B,CAAC,OAAO,EAAE;IAClCC,GAAK,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC;IAC3CA,GAAK,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;IACzCA,GAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IACxCA,GAAK,CAAC,EAAE,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;IAC3B,OAAO,WAAW;MAChB,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,EAAE;QACvBC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC;QACV,KAAK,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;UAC7C,EAAE,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;SAC/B;OACF;MACD,OAAO,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;MACrC,OAAO,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;KACrC,CAAC;IACH;;;;;;;;;;+BAUD,2CAAe,CAAC,eAAe,EAAE,MAAM,EAAE,GAAG,EAAE,MAAM,EAAE;IACpDD,GAAK,CAAC,OAAO,yBAAyB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACrDA,GAAK,CAAC,OAAO,yBAAyB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACrDA,GAAK,CAAC,MAAM,yBAAyB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACnDA,GAAK,CAAC,WAAW,yBAAyB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IAC7DA,GAAK,CAAC,UAAU,yBAAyB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAC3DA,GAAK,CAAC,OAAO,yBAAyB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACrDA,GAAK,CAAC,OAAO,yBAAyB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACrDA,GAAK,CAAC,OAAO,yBAAyB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACrDA,GAAK,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,GAAG,GAAG,GAAG,GAAG,CAAC;;IAEvDA,GAAK,CAAC,QAAQ,yBAAyB,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACxDA,GAAK,CAAC,KAAK,yBAAyB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACjDA,GAAK,CAAC,KAAK,yBAAyB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACjDA,GAAK,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC/BA,GAAK,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC/BC,GAAG,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;IACrCA,GAAG,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;IACvCA,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC;IACjC,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,IAAI,MAAM,EAAE;MACrC,CAAC,GAAG,eAAe,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;MACxC,CAAC,GAAG,eAAe,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;;;;;;;;;;;;MAY5C,CAAC,GAAG,WAAW,GAAG,CAAC,CAAC;;;MAGpB,OAAO,GAAG,CAAC,KAAK,GAAG,OAAO,CAAC;MAC3B,OAAO,GAAG,CAAC,KAAK,GAAG,CAAC,MAAM,GAAG,OAAO,CAAC,CAAC;MACtC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,CAAC;MACjC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,CAAC;MACjC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,CAAC;MAC7D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,CAAC;MAC7D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,UAAU,CAAC;MACpD,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,OAAO,GAAG,MAAM,CAAC,GAAG,WAAW,CAAC;MAChE,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,CAAC;MACvC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,cAAc,CAAC;;;MAG9C,OAAO,GAAG,KAAK,GAAG,CAAC,KAAK,GAAG,OAAO,CAAC,CAAC;MACpC,OAAO,GAAG,CAAC,KAAK,GAAG,CAAC,MAAM,GAAG,OAAO,CAAC,CAAC;MACtC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,CAAC;MACjC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,CAAC;MACjC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,CAAC;MAC7D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,CAAC;MAC7D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,OAAO,GAAG,KAAK,CAAC,GAAG,UAAU,CAAC;MAC9D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,OAAO,GAAG,MAAM,CAAC,GAAG,WAAW,CAAC;MAChE,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,CAAC;MACvC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,cAAc,CAAC;;;MAG9C,OAAO,GAAG,KAAK,GAAG,CAAC,KAAK,GAAG,OAAO,CAAC,CAAC;MACpC,OAAO,GAAG,KAAK,GAAG,OAAO,CAAC;MAC1B,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,CAAC;MACjC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,CAAC;MACjC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,CAAC;MAC7D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,CAAC;MAC7D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,OAAO,GAAG,KAAK,CAAC,GAAG,UAAU,CAAC;MAC9D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,WAAW,CAAC;MACrD,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,CAAC;MACvC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,cAAc,CAAC;;;MAG9C,OAAO,GAAG,CAAC,KAAK,GAAG,OAAO,CAAC;MAC3B,OAAO,GAAG,KAAK,GAAG,OAAO,CAAC;MAC1B,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,CAAC;MACjC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,CAAC;MACjC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,CAAC;MAC7D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,CAAC;MAC7D,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,UAAU,CAAC;MACpD,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,GAAG,WAAW,CAAC;MACrD,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,CAAC;MACvC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,GAAG,cAAc,CAAC;;MAE9C,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,GAAG,CAAC,CAAC;MAC/B,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;MACnC,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;MACnC,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,GAAG,CAAC,CAAC;MAC/B,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;MACnC,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;KACpC;;IAED,OAAO,WAAW,CAAC;IACpB;;;;;;;;;+BASD,yCAAc,CAAC,QAAQ,EAAE,MAAM,EAAE,eAAe,EAAE,EAAE,EAAE;IACpDA,GAAG,CAAC,OAAO,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC;IAC3BD,GAAK,CAAC,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC;IACzB,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;MACvB,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;;MAElB,GAAG,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;MACpB,IAAI,GAAG,IAAI,eAAe,EAAE;QAC1B,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,CAAC;OAChC,MAAM;QACL,OAAO,GAAG,aAAa;UACrB,EAAE,EAAE,KAAK,EAAE,aAAa,EAAE,aAAa,CAAC,CAAC;QAC3C,eAAe,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC;OAChC;MACD,QAAQ,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC;KACvB;IACF;;;;;+BAKD,qCAAY,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE;;IAE1CA,GAAK,CAAC,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;;;IAGrDC,GAAG,CAAC,SAAS,CAAC;IACd,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;MAC1B,SAAS,GAAG,IAAI,SAAS,CAAC,EAAE,EAAE,OAAO,CAAC,CAAC;MACvC,IAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC;KACnC,MAAM;MACL,SAAS,GAAG,IAAI,CAAC,gBAAgB,CAAC;KACnC;;;IAGD,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;;;IAG5B,EAAE,CAAC,uBAAuB,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IACjD,EAAE,CAAC,mBAAmB,CAAC,SAAS,CAAC,UAAU,EAAE,CAAC,EAAE,KAAK;MACnD,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;;IAEhB,EAAE,CAAC,uBAAuB,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;IAChD,EAAE,CAAC,mBAAmB,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,EAAE,KAAK;MAClD,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;;IAEhB,EAAE,CAAC,uBAAuB,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IACjD,EAAE,CAAC,mBAAmB,CAAC,SAAS,CAAC,UAAU,EAAE,CAAC,EAAE,KAAK;MACnD,KAAK,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;;IAEjB,EAAE,CAAC,uBAAuB,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;IAChD,EAAE,CAAC,mBAAmB,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,EAAE,KAAK;MAClD,KAAK,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;;IAEjB,EAAE,CAAC,uBAAuB,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;IACvD,EAAE,CAAC,mBAAmB,CAAC,SAAS,CAAC,gBAAgB,EAAE,CAAC,EAAE,KAAK;MACzD,KAAK,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;;IAEjB,OAAO,SAAS,CAAC;IAClB;;;;;+BAKD,2CAAe,CAAC,EAAE,EAAE,SAAS,EAAE;IAC7B,EAAE,CAAC,wBAAwB,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IAClD,EAAE,CAAC,wBAAwB,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;IACjD,EAAE,CAAC,wBAAwB,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IAClD,EAAE,CAAC,wBAAwB,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;IACjD,EAAE,CAAC,wBAAwB,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;IACzD;;;;;+BAKD,iCAAU,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,YAAY,EAAE;IACzDD,GAAK,CAAC,QAAQ,GAAG,YAAY,GAAG,IAAI,CAAC,uBAAuB,EAAE,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;IACpFA,GAAK,CAAC,YAAY,GAAG,YAAY,GAAG,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC,YAAY,CAAC;;IAEtF,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,EAAE;MACjC,IAAI,CAAC,kBAAkB,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAC;KACnF,MAAM;MACLC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC;MACjB,KAAK,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,MAAM,EAAE,KAAK,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;QACxD,EAAE,CAAC,WAAW,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;QACxCD,GAAK,CAAC,GAAG,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;QAC5B,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;QAC3C,KAAK,GAAG,GAAG,CAAC;OACb;KACF;IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BA4BD,iDAAkB,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,QAAQ,EAAE,YAAY,EAAE;IAC3EC,GAAG,CAAC,YAAY,GAAG,CAAC,CAAC;;IAErBA,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC;IACV,KAAK,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;MAC7C,EAAE,CAAC,WAAW,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;MACxCD,GAAK,CAAC,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;MACrDA,GAAK,CAAC,QAAQ,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;;MAEjCC,GAAG,CAAC,KAAK,GAAG,UAAU,CAAC;MACvBA,GAAG,CAAC,GAAG,GAAG,UAAU,CAAC;MACrB,OAAO,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM;UAC1C,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,QAAQ,EAAE;QAC/CD,GAAK,CAAC,OAAO,GAAG,IAAI,CAAC,mBAAmB,CAAC,YAAY,CAAC,CAAC;;QAEvD,IAAI,mBAAmB,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,SAAS,EAAE;;UAEtD,IAAI,KAAK,KAAK,GAAG,EAAE;;YAEjB,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;WAC5C;;UAED,KAAK,GAAG,CAAC,YAAY,KAAK,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;YACrD,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC;UACjD,GAAG,GAAG,KAAK,CAAC;SACb,MAAM;;UAEL,GAAG,GAAG,CAAC,YAAY,KAAK,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;YACnD,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC;SAClD;QACD,YAAY,EAAE,CAAC;OAChB;;MAED,IAAI,KAAK,KAAK,GAAG,EAAE;;;QAGjB,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;OAC5C;KACF;IACF;;;;;+BAKD,yEAA8B,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,eAAe,EAAE,aAAa,EAAE;IAC/FC,GAAG,CAAC,CAAC,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,EAAE,OAAO,CAAC;IACvCA,GAAG,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;IAChDD,GAAK,CAAC,oBAAoB,GAAG,IAAI,CAAC,uBAAuB,EAAE,CAAC;IAC5D,KAAK,CAAC,GAAG,oBAAoB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE;MACrD,EAAE,CAAC,WAAW,CAAC,UAAU,EAAE,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;MACpD,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;MAChE,GAAG,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC,CAAC;;;MAGvC,OAAO,YAAY,IAAI,CAAC;UACpB,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,UAAU,EAAE;QACjD,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;QACxC,OAAO,GAAG,IAAI,CAAC,mBAAmB,CAAC,YAAY,CAAC,CAAC;;QAEjD,IAAI,mBAAmB,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,SAAS;YAClD,OAAO,CAAC,WAAW,EAAE;YACrB,CAAC,aAAa,KAAK,SAAS,IAAI,UAAU;2CACX,CAAC,aAAa,CAAC;cAC5C,OAAO,CAAC,WAAW,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE;UACzC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,GAAG,EAAE,CAAC,gBAAgB,CAAC,CAAC;UACpD,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;;UAE3CA,GAAK,CAAC,MAAM,GAAG,eAAe,CAAC,OAAO,CAAC,CAAC;UACxC,IAAI,MAAM,EAAE;YACV,OAAO,MAAM,CAAC;WACf;SACF;;QAED,GAAG,GAAG,KAAK,CAAC;QACZ,YAAY,EAAE,CAAC;OAChB;KACF;IACD,OAAO,SAAS,CAAC;IAClB;;;;;+BAKD,yBAAM,CAAC,OAAO,EAAE;IACd,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;IACzB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;IACzB,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;IACxB,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;IAC7B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;IAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACpB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;IACzB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;IACzB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;IACzB,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;IAChC,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;IAC1B,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;IACvB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACrB,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;IACxB;;;;;;;;+BAQD,mCAAW,CAAC,OAAO,EAAE;IACnB,OAAO,QAAQ,EAAE,CAAC;IACnB;;;;;;;+BAOD,2DAAuB,GAAG;IACxB,OAAO,QAAQ,EAAE,CAAC;GACnB;;;EA/c8B,cAgdhC;;;AAGD,eAAe,kBAAkB,CAAC;"}