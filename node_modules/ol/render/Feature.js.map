{"version":3,"file":"Feature.js","sources":["../../../src/ol/render/Feature.js"],"sourcesContent":["/**\n * @module ol/render/Feature\n */\nimport {extend} from '../array.js';\nimport {createOrUpdateFromCoordinate, createOrUpdateFromFlatCoordinates, getCenter, getHeight} from '../extent.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport {linearRingss as linearRingssCenter} from '../geom/flat/center.js';\nimport {getInteriorPointOfArray, getInteriorPointsOfMultiArray} from '../geom/flat/interiorpoint.js';\nimport {interpolatePoint} from '../geom/flat/interpolate.js';\nimport {get as getProjection} from '../proj.js';\nimport {transform2D} from '../geom/flat/transform.js';\nimport {create as createTransform, compose as composeTransform} from '../transform.js';\n\n\n/**\n * @type {import(\"../transform.js\").Transform}\n */\nconst tmpTransform = createTransform();\n\n\n/**\n * Lightweight, read-only, {@link module:ol/Feature~Feature} and {@link module:ol/geom/Geometry~Geometry} like\n * structure, optimized for vector tile rendering and styling. Geometry access\n * through the API is limited to getting the type and extent of the geometry.\n *\n * @param {GeometryType} type Geometry type.\n * @param {Array<number>} flatCoordinates Flat coordinates. These always need\n *     to be right-handed for polygons.\n * @param {Array<number>|Array<Array<number>>} ends Ends or Endss.\n * @param {Object<string, *>} properties Properties.\n * @param {number|string|undefined} id Feature id.\n */\nclass RenderFeature {\n  constructor(type, flatCoordinates, ends, properties, id) {\n    /**\n    * @private\n    * @type {import(\"../extent.js\").Extent|undefined}\n    */\n    this.extent_;\n\n    /**\n    * @private\n    * @type {number|string|undefined}\n    */\n    this.id_ = id;\n\n    /**\n    * @private\n    * @type {GeometryType}\n    */\n    this.type_ = type;\n\n    /**\n    * @private\n    * @type {Array<number>}\n    */\n    this.flatCoordinates_ = flatCoordinates;\n\n    /**\n    * @private\n    * @type {Array<number>}\n    */\n    this.flatInteriorPoints_ = null;\n\n    /**\n    * @private\n    * @type {Array<number>}\n    */\n    this.flatMidpoints_ = null;\n\n    /**\n    * @private\n    * @type {Array<number>|Array<Array<number>>}\n    */\n    this.ends_ = ends;\n\n    /**\n    * @private\n    * @type {Object<string, *>}\n    */\n    this.properties_ = properties;\n\n  }\n\n  /**\n  * Get a feature property by its key.\n  * @param {string} key Key\n  * @return {*} Value for the requested key.\n  * @api\n  */\n  get(key) {\n    return this.properties_[key];\n  }\n\n  /**\n  * Get the extent of this feature's geometry.\n  * @return {import(\"../extent.js\").Extent} Extent.\n  * @api\n  */\n  getExtent() {\n    if (!this.extent_) {\n      this.extent_ = this.type_ === GeometryType.POINT ?\n        createOrUpdateFromCoordinate(this.flatCoordinates_) :\n        createOrUpdateFromFlatCoordinates(\n          this.flatCoordinates_, 0, this.flatCoordinates_.length, 2);\n\n    }\n    return this.extent_;\n  }\n\n  /**\n  * @return {Array<number>} Flat interior points.\n  */\n  getFlatInteriorPoint() {\n    if (!this.flatInteriorPoints_) {\n      const flatCenter = getCenter(this.getExtent());\n      this.flatInteriorPoints_ = getInteriorPointOfArray(\n        this.flatCoordinates_, 0, /** @type {Array<number>} */ (this.ends_), 2, flatCenter, 0);\n    }\n    return this.flatInteriorPoints_;\n  }\n\n  /**\n  * @return {Array<number>} Flat interior points.\n  */\n  getFlatInteriorPoints() {\n    if (!this.flatInteriorPoints_) {\n      const flatCenters = linearRingssCenter(\n        this.flatCoordinates_, 0, /** @type {Array<Array<number>>} */ (this.ends_), 2);\n      this.flatInteriorPoints_ = getInteriorPointsOfMultiArray(\n        this.flatCoordinates_, 0, /** @type {Array<Array<number>>} */ (this.ends_), 2, flatCenters);\n    }\n    return this.flatInteriorPoints_;\n  }\n\n  /**\n  * @return {Array<number>} Flat midpoint.\n  */\n  getFlatMidpoint() {\n    if (!this.flatMidpoints_) {\n      this.flatMidpoints_ = interpolatePoint(\n        this.flatCoordinates_, 0, this.flatCoordinates_.length, 2, 0.5);\n    }\n    return this.flatMidpoints_;\n  }\n\n  /**\n  * @return {Array<number>} Flat midpoints.\n  */\n  getFlatMidpoints() {\n    if (!this.flatMidpoints_) {\n      this.flatMidpoints_ = [];\n      const flatCoordinates = this.flatCoordinates_;\n      let offset = 0;\n      const ends = /** @type {Array<number>} */ (this.ends_);\n      for (let i = 0, ii = ends.length; i < ii; ++i) {\n        const end = ends[i];\n        const midpoint = interpolatePoint(\n          flatCoordinates, offset, end, 2, 0.5);\n        extend(this.flatMidpoints_, midpoint);\n        offset = end;\n      }\n    }\n    return this.flatMidpoints_;\n  }\n\n  /**\n  * Get the feature identifier.  This is a stable identifier for the feature and\n  * is set when reading data from a remote source.\n  * @return {number|string|undefined} Id.\n  * @api\n  */\n  getId() {\n    return this.id_;\n  }\n\n  /**\n  * @return {Array<number>} Flat coordinates.\n  */\n  getOrientedFlatCoordinates() {\n    return this.flatCoordinates_;\n  }\n\n  /**\n  * For API compatibility with {@link module:ol/Feature~Feature}, this method is useful when\n  * determining the geometry type in style function (see {@link #getType}).\n  * @return {RenderFeature} Feature.\n  * @api\n  */\n  getGeometry() {\n    return this;\n  }\n\n  /**\n   * @param {number} squaredTolerance Squared tolerance.\n   * @return {RenderFeature} Simplified geometry.\n   */\n  getSimplifiedGeometry(squaredTolerance) {\n    return this;\n  }\n\n  /**\n  * Get the feature properties.\n  * @return {Object<string, *>} Feature properties.\n  * @api\n  */\n  getProperties() {\n    return this.properties_;\n  }\n\n  /**\n  * @return {number} Stride.\n  */\n  getStride() {\n    return 2;\n  }\n\n  /**\n   * @return {undefined}\n   */\n  getStyleFunction() {\n    return undefined;\n  }\n\n  /**\n  * Get the type of this feature's geometry.\n  * @return {GeometryType} Geometry type.\n  * @api\n  */\n  getType() {\n    return this.type_;\n  }\n\n  /**\n  * Transform geometry coordinates from tile pixel space to projected.\n  * The SRS of the source and destination are expected to be the same.\n  *\n  * @param {import(\"../proj.js\").ProjectionLike} source The current projection\n  * @param {import(\"../proj.js\").ProjectionLike} destination The desired projection.\n  */\n  transform(source, destination) {\n    source = getProjection(source);\n    const pixelExtent = source.getExtent();\n    const projectedExtent = source.getWorldExtent();\n    const scale = getHeight(projectedExtent) / getHeight(pixelExtent);\n    composeTransform(tmpTransform,\n      projectedExtent[0], projectedExtent[3],\n      scale, -scale, 0,\n      0, 0);\n    transform2D(this.flatCoordinates_, 0, this.flatCoordinates_.length, 2,\n      tmpTransform, this.flatCoordinates_);\n  }\n}\n\n\n/**\n * @return {Array<number>|Array<Array<number>>} Ends or endss.\n */\nRenderFeature.prototype.getEnds =\nRenderFeature.prototype.getEndss = function() {\n  return this.ends_;\n};\n\n\n/**\n * @return {Array<number>} Flat coordinates.\n */\nRenderFeature.prototype.getFlatCoordinates =\n    RenderFeature.prototype.getOrientedFlatCoordinates;\n\n\nexport default RenderFeature;\n"],"names":["const","let"],"mappings":"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"}