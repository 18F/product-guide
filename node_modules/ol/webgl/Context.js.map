{"version":3,"file":"Context.js","sources":["../../../src/ol/webgl/Context.js"],"sourcesContent":["/**\n * @module ol/webgl/Context\n */\nimport {getUid} from '../util.js';\nimport {EXTENSIONS as WEBGL_EXTENSIONS} from '../webgl.js';\nimport Disposable from '../Disposable.js';\nimport {includes} from '../array.js';\nimport {listen, unlistenAll} from '../events.js';\nimport {clear} from '../obj.js';\nimport {ARRAY_BUFFER, ELEMENT_ARRAY_BUFFER, TEXTURE_2D, TEXTURE_WRAP_S, TEXTURE_WRAP_T} from '../webgl.js';\nimport ContextEventType from '../webgl/ContextEventType.js';\n\n\n/**\n * @typedef {Object} BufferCacheEntry\n * @property {import(\"./Buffer.js\").default} buf\n * @property {WebGLBuffer} buffer\n */\n\n\n/**\n * @classdesc\n * A WebGL context for accessing low-level WebGL capabilities.\n */\nclass WebGLContext extends Disposable {\n\n  /**\n   * @param {HTMLCanvasElement} canvas Canvas.\n   * @param {WebGLRenderingContext} gl GL.\n   */\n  constructor(canvas, gl) {\n    super();\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.canvas_ = canvas;\n\n    /**\n     * @private\n     * @type {WebGLRenderingContext}\n     */\n    this.gl_ = gl;\n\n    /**\n     * @private\n     * @type {!Object<string, BufferCacheEntry>}\n     */\n    this.bufferCache_ = {};\n\n    /**\n     * @private\n     * @type {!Object<string, WebGLShader>}\n     */\n    this.shaderCache_ = {};\n\n    /**\n     * @private\n     * @type {!Object<string, WebGLProgram>}\n     */\n    this.programCache_ = {};\n\n    /**\n     * @private\n     * @type {WebGLProgram}\n     */\n    this.currentProgram_ = null;\n\n    /**\n     * @private\n     * @type {WebGLFramebuffer}\n     */\n    this.hitDetectionFramebuffer_ = null;\n\n    /**\n     * @private\n     * @type {WebGLTexture}\n     */\n    this.hitDetectionTexture_ = null;\n\n    /**\n     * @private\n     * @type {WebGLRenderbuffer}\n     */\n    this.hitDetectionRenderbuffer_ = null;\n\n    /**\n     * @type {boolean}\n     */\n    this.hasOESElementIndexUint = includes(WEBGL_EXTENSIONS, 'OES_element_index_uint');\n\n    // use the OES_element_index_uint extension if available\n    if (this.hasOESElementIndexUint) {\n      gl.getExtension('OES_element_index_uint');\n    }\n\n    listen(this.canvas_, ContextEventType.LOST,\n      this.handleWebGLContextLost, this);\n    listen(this.canvas_, ContextEventType.RESTORED,\n      this.handleWebGLContextRestored, this);\n\n  }\n\n  /**\n   * Just bind the buffer if it's in the cache. Otherwise create\n   * the WebGL buffer, bind it, populate it, and add an entry to\n   * the cache.\n   * @param {number} target Target.\n   * @param {import(\"./Buffer.js\").default} buf Buffer.\n   */\n  bindBuffer(target, buf) {\n    const gl = this.getGL();\n    const arr = buf.getArray();\n    const bufferKey = getUid(buf);\n    if (bufferKey in this.bufferCache_) {\n      const bufferCacheEntry = this.bufferCache_[bufferKey];\n      gl.bindBuffer(target, bufferCacheEntry.buffer);\n    } else {\n      const buffer = gl.createBuffer();\n      gl.bindBuffer(target, buffer);\n      let /** @type {ArrayBufferView} */ arrayBuffer;\n      if (target == ARRAY_BUFFER) {\n        arrayBuffer = new Float32Array(arr);\n      } else if (target == ELEMENT_ARRAY_BUFFER) {\n        arrayBuffer = this.hasOESElementIndexUint ?\n          new Uint32Array(arr) : new Uint16Array(arr);\n      }\n      gl.bufferData(target, arrayBuffer, buf.getUsage());\n      this.bufferCache_[bufferKey] = {\n        buf: buf,\n        buffer: buffer\n      };\n    }\n  }\n\n  /**\n   * @param {import(\"./Buffer.js\").default} buf Buffer.\n   */\n  deleteBuffer(buf) {\n    const gl = this.getGL();\n    const bufferKey = getUid(buf);\n    const bufferCacheEntry = this.bufferCache_[bufferKey];\n    if (!gl.isContextLost()) {\n      gl.deleteBuffer(bufferCacheEntry.buffer);\n    }\n    delete this.bufferCache_[bufferKey];\n  }\n\n  /**\n   * @inheritDoc\n   */\n  disposeInternal() {\n    unlistenAll(this.canvas_);\n    const gl = this.getGL();\n    if (!gl.isContextLost()) {\n      for (const key in this.bufferCache_) {\n        gl.deleteBuffer(this.bufferCache_[key].buffer);\n      }\n      for (const key in this.programCache_) {\n        gl.deleteProgram(this.programCache_[key]);\n      }\n      for (const key in this.shaderCache_) {\n        gl.deleteShader(this.shaderCache_[key]);\n      }\n      // delete objects for hit-detection\n      gl.deleteFramebuffer(this.hitDetectionFramebuffer_);\n      gl.deleteRenderbuffer(this.hitDetectionRenderbuffer_);\n      gl.deleteTexture(this.hitDetectionTexture_);\n    }\n  }\n\n  /**\n   * @return {HTMLCanvasElement} Canvas.\n   */\n  getCanvas() {\n    return this.canvas_;\n  }\n\n  /**\n   * Get the WebGL rendering context\n   * @return {WebGLRenderingContext} The rendering context.\n   * @api\n   */\n  getGL() {\n    return this.gl_;\n  }\n\n  /**\n   * Get the frame buffer for hit detection.\n   * @return {WebGLFramebuffer} The hit detection frame buffer.\n   */\n  getHitDetectionFramebuffer() {\n    if (!this.hitDetectionFramebuffer_) {\n      this.initHitDetectionFramebuffer_();\n    }\n    return this.hitDetectionFramebuffer_;\n  }\n\n  /**\n   * Get shader from the cache if it's in the cache. Otherwise, create\n   * the WebGL shader, compile it, and add entry to cache.\n   * @param {import(\"./Shader.js\").default} shaderObject Shader object.\n   * @return {WebGLShader} Shader.\n   */\n  getShader(shaderObject) {\n    const shaderKey = getUid(shaderObject);\n    if (shaderKey in this.shaderCache_) {\n      return this.shaderCache_[shaderKey];\n    } else {\n      const gl = this.getGL();\n      const shader = gl.createShader(shaderObject.getType());\n      gl.shaderSource(shader, shaderObject.getSource());\n      gl.compileShader(shader);\n      this.shaderCache_[shaderKey] = shader;\n      return shader;\n    }\n  }\n\n  /**\n   * Get the program from the cache if it's in the cache. Otherwise create\n   * the WebGL program, attach the shaders to it, and add an entry to the\n   * cache.\n   * @param {import(\"./Fragment.js\").default} fragmentShaderObject Fragment shader.\n   * @param {import(\"./Vertex.js\").default} vertexShaderObject Vertex shader.\n   * @return {WebGLProgram} Program.\n   */\n  getProgram(fragmentShaderObject, vertexShaderObject) {\n    const programKey = getUid(fragmentShaderObject) + '/' + getUid(vertexShaderObject);\n    if (programKey in this.programCache_) {\n      return this.programCache_[programKey];\n    } else {\n      const gl = this.getGL();\n      const program = gl.createProgram();\n      gl.attachShader(program, this.getShader(fragmentShaderObject));\n      gl.attachShader(program, this.getShader(vertexShaderObject));\n      gl.linkProgram(program);\n      this.programCache_[programKey] = program;\n      return program;\n    }\n  }\n\n  /**\n   * FIXME empty description for jsdoc\n   */\n  handleWebGLContextLost() {\n    clear(this.bufferCache_);\n    clear(this.shaderCache_);\n    clear(this.programCache_);\n    this.currentProgram_ = null;\n    this.hitDetectionFramebuffer_ = null;\n    this.hitDetectionTexture_ = null;\n    this.hitDetectionRenderbuffer_ = null;\n  }\n\n  /**\n   * FIXME empty description for jsdoc\n   */\n  handleWebGLContextRestored() {\n  }\n\n  /**\n   * Creates a 1x1 pixel framebuffer for the hit-detection.\n   * @private\n   */\n  initHitDetectionFramebuffer_() {\n    const gl = this.gl_;\n    const framebuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\n    const texture = createEmptyTexture(gl, 1, 1);\n    const renderbuffer = gl.createRenderbuffer();\n    gl.bindRenderbuffer(gl.RENDERBUFFER, renderbuffer);\n    gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, 1, 1);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n    gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT,\n      gl.RENDERBUFFER, renderbuffer);\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n    this.hitDetectionFramebuffer_ = framebuffer;\n    this.hitDetectionTexture_ = texture;\n    this.hitDetectionRenderbuffer_ = renderbuffer;\n  }\n\n  /**\n   * Use a program.  If the program is already in use, this will return `false`.\n   * @param {WebGLProgram} program Program.\n   * @return {boolean} Changed.\n   * @api\n   */\n  useProgram(program) {\n    if (program == this.currentProgram_) {\n      return false;\n    } else {\n      const gl = this.getGL();\n      gl.useProgram(program);\n      this.currentProgram_ = program;\n      return true;\n    }\n  }\n}\n\n\n/**\n * @param {WebGLRenderingContext} gl WebGL rendering context.\n * @param {number=} opt_wrapS wrapS.\n * @param {number=} opt_wrapT wrapT.\n * @return {WebGLTexture} The texture.\n */\nfunction createTextureInternal(gl, opt_wrapS, opt_wrapT) {\n  const texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\n  if (opt_wrapS !== undefined) {\n    gl.texParameteri(\n      TEXTURE_2D, TEXTURE_WRAP_S, opt_wrapS);\n  }\n  if (opt_wrapT !== undefined) {\n    gl.texParameteri(\n      TEXTURE_2D, TEXTURE_WRAP_T, opt_wrapT);\n  }\n\n  return texture;\n}\n\n\n/**\n * @param {WebGLRenderingContext} gl WebGL rendering context.\n * @param {number} width Width.\n * @param {number} height Height.\n * @param {number=} opt_wrapS wrapS.\n * @param {number=} opt_wrapT wrapT.\n * @return {WebGLTexture} The texture.\n */\nexport function createEmptyTexture(gl, width, height, opt_wrapS, opt_wrapT) {\n  const texture = createTextureInternal(gl, opt_wrapS, opt_wrapT);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n  return texture;\n}\n\n\n/**\n * @param {WebGLRenderingContext} gl WebGL rendering context.\n * @param {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} image Image.\n * @param {number=} opt_wrapS wrapS.\n * @param {number=} opt_wrapT wrapT.\n * @return {WebGLTexture} The texture.\n */\nexport function createTexture(gl, image, opt_wrapS, opt_wrapT) {\n  const texture = createTextureInternal(gl, opt_wrapS, opt_wrapT);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n  return texture;\n}\n\nexport default WebGLContext;\n"],"names":["super","const","let","key"],"mappings":"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"}