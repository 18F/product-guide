{"version":3,"file":"IconImageCache.js","sources":["../../../src/ol/style/IconImageCache.js"],"sourcesContent":["/**\n * @module ol/style/IconImageCache\n */\nimport {asString} from '../color.js';\n\n/**\n * @classdesc\n * Singleton class. Available through {@link module:ol/style/IconImageCache~shared}.\n */\nclass IconImageCache {\n  constructor() {\n\n    /**\n    * @type {!Object<string, import(\"./IconImage.js\").default>}\n    * @private\n    */\n    this.cache_ = {};\n\n    /**\n    * @type {number}\n    * @private\n    */\n    this.cacheSize_ = 0;\n\n    /**\n    * @type {number}\n    * @private\n    */\n    this.maxCacheSize_ = 32;\n  }\n\n  /**\n  * FIXME empty description for jsdoc\n  */\n  clear() {\n    this.cache_ = {};\n    this.cacheSize_ = 0;\n  }\n\n  /**\n  * FIXME empty description for jsdoc\n  */\n  expire() {\n    if (this.cacheSize_ > this.maxCacheSize_) {\n      let i = 0;\n      for (const key in this.cache_) {\n        const iconImage = this.cache_[key];\n        if ((i++ & 3) === 0 && !iconImage.hasListener()) {\n          delete this.cache_[key];\n          --this.cacheSize_;\n        }\n      }\n    }\n  }\n\n  /**\n  * @param {string} src Src.\n  * @param {?string} crossOrigin Cross origin.\n  * @param {import(\"../color.js\").Color} color Color.\n  * @return {import(\"./IconImage.js\").default} Icon image.\n  */\n  get(src, crossOrigin, color) {\n    const key = getKey(src, crossOrigin, color);\n    return key in this.cache_ ? this.cache_[key] : null;\n  }\n\n  /**\n  * @param {string} src Src.\n  * @param {?string} crossOrigin Cross origin.\n  * @param {import(\"../color.js\").Color} color Color.\n  * @param {import(\"./IconImage.js\").default} iconImage Icon image.\n  */\n  set(src, crossOrigin, color, iconImage) {\n    const key = getKey(src, crossOrigin, color);\n    this.cache_[key] = iconImage;\n    ++this.cacheSize_;\n  }\n\n  /**\n  * Set the cache size of the icon cache. Default is `32`. Change this value when\n  * your map uses more than 32 different icon images and you are not caching icon\n  * styles on the application level.\n  * @param {number} maxCacheSize Cache max size.\n  * @api\n  */\n  setSize(maxCacheSize) {\n    this.maxCacheSize_ = maxCacheSize;\n    this.expire();\n  }\n}\n\n\n/**\n * @param {string} src Src.\n * @param {?string} crossOrigin Cross origin.\n * @param {import(\"../color.js\").Color} color Color.\n * @return {string} Cache key.\n */\nfunction getKey(src, crossOrigin, color) {\n  const colorString = color ? asString(color) : 'null';\n  return crossOrigin + ':' + src + ':' + colorString;\n}\n\n\nexport default IconImageCache;\n\n\n/**\n * The {@link module:ol/style/IconImageCache~IconImageCache} for\n * {@link module:ol/style/Icon~Icon} images.\n * @api\n */\nexport const shared = new IconImageCache();\n"],"names":["let","const"],"mappings":"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"}