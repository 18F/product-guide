{"version":3,"file":"PluggableMap.js","sources":["../../src/ol/PluggableMap.js"],"sourcesContent":["/**\n * @module ol/PluggableMap\n */\nimport {getUid} from './util.js';\nimport Collection from './Collection.js';\nimport CollectionEventType from './CollectionEventType.js';\nimport MapBrowserEvent from './MapBrowserEvent.js';\nimport MapBrowserEventHandler from './MapBrowserEventHandler.js';\nimport MapBrowserEventType from './MapBrowserEventType.js';\nimport MapEvent from './MapEvent.js';\nimport MapEventType from './MapEventType.js';\nimport MapProperty from './MapProperty.js';\nimport RenderEventType from './render/EventType.js';\nimport BaseObject, {getChangeEventType} from './Object.js';\nimport ObjectEventType from './ObjectEventType.js';\nimport TileQueue from './TileQueue.js';\nimport View from './View.js';\nimport ViewHint from './ViewHint.js';\nimport {assert} from './asserts.js';\nimport {removeNode} from './dom.js';\nimport {listen, unlistenByKey, unlisten} from './events.js';\nimport {stopPropagation} from './events/Event.js';\nimport EventType from './events/EventType.js';\nimport {createEmpty, clone, createOrUpdateEmpty, equals, getForViewAndSize, isEmpty} from './extent.js';\nimport {TRUE} from './functions.js';\nimport {DEVICE_PIXEL_RATIO, TOUCH} from './has.js';\nimport LayerGroup from './layer/Group.js';\nimport {hasArea} from './size.js';\nimport {DROP} from './structs/PriorityQueue.js';\nimport {create as createTransform, apply as applyTransform} from './transform.js';\n\n\n/**\n * State of the current frame. Only `pixelRatio`, `time` and `viewState` should\n * be used in applications.\n * @typedef {Object} FrameState\n * @property {number} pixelRatio The pixel ratio of the frame.\n * @property {number} time The time when rendering of the frame was requested.\n * @property {import(\"./View.js\").State} viewState The state of the current view.\n * @property {boolean} animate\n * @property {import(\"./transform.js\").Transform} coordinateToPixelTransform\n * @property {null|import(\"./extent.js\").Extent} extent\n * @property {import(\"./coordinate.js\").Coordinate} focus\n * @property {number} index\n * @property {Object<string, import(\"./layer/Layer.js\").State>} layerStates\n * @property {Array<import(\"./layer/Layer.js\").State>} layerStatesArray\n * @property {import(\"./transform.js\").Transform} pixelToCoordinateTransform\n * @property {Array<PostRenderFunction>} postRenderFunctions\n * @property {import(\"./size.js\").Size} size\n * @property {!Object<string, boolean>} skippedFeatureUids\n * @property {TileQueue} tileQueue\n * @property {Object<string, Object<string, import(\"./TileRange.js\").default>>} usedTiles\n * @property {Array<number>} viewHints\n * @property {!Object<string, Object<string, boolean>>} wantedTiles\n */\n\n\n/**\n * @typedef {function(PluggableMap, ?FrameState): boolean} PostRenderFunction\n */\n\n\n/**\n * @typedef {Object} AtPixelOptions\n * @property {undefined|function(import(\"./layer/Layer.js\").default): boolean} layerFilter Layer filter\n * function. The filter function will receive one argument, the\n * {@link module:ol/layer/Layer layer-candidate} and it should return a boolean value.\n * Only layers which are visible and for which this function returns `true`\n * will be tested for features. By default, all visible layers will be tested.\n * @property {number} [hitTolerance=0] Hit-detection tolerance in pixels. Pixels\n * inside the radius around the given position will be checked for features. This only\n * works for the canvas renderer and not for WebGL.\n */\n\n\n/**\n * @typedef {Object} MapOptionsInternal\n * @property {Collection<import(\"./control/Control.js\").default>} [controls]\n * @property {Collection<import(\"./interaction/Interaction.js\").default>} [interactions]\n * @property {HTMLElement|Document} keyboardEventTarget\n * @property {Collection<import(\"./Overlay.js\").default>} overlays\n * @property {Object<string, *>} values\n */\n\n\n/**\n * Object literal with config options for the map.\n * @typedef {Object} MapOptions\n * @property {Collection<import(\"./control/Control.js\").default>|Array<import(\"./control/Control.js\").default>} [controls]\n * Controls initially added to the map. If not specified,\n * {@link module:ol/control~defaults} is used.\n * @property {number} [pixelRatio=window.devicePixelRatio] The ratio between\n * physical pixels and device-independent pixels (dips) on the device.\n * @property {Collection<import(\"./interaction/Interaction.js\").default>|Array<import(\"./interaction/Interaction.js\").default>} [interactions]\n * Interactions that are initially added to the map. If not specified,\n * {@link module:ol/interaction~defaults} is used.\n * @property {HTMLElement|Document|string} [keyboardEventTarget] The element to\n * listen to keyboard events on. This determines when the `KeyboardPan` and\n * `KeyboardZoom` interactions trigger. For example, if this option is set to\n * `document` the keyboard interactions will always trigger. If this option is\n * not specified, the element the library listens to keyboard events on is the\n * map target (i.e. the user-provided div for the map). If this is not\n * `document`, the target element needs to be focused for key events to be\n * emitted, requiring that the target element has a `tabindex` attribute.\n * @property {Array<import(\"./layer/Base.js\").default>|Collection<import(\"./layer/Base.js\").default>|LayerGroup} [layers]\n * Layers. If this is not defined, a map with no layers will be rendered. Note\n * that layers are rendered in the order supplied, so if you want, for example,\n * a vector layer to appear on top of a tile layer, it must come after the tile\n * layer.\n * @property {number} [maxTilesLoading=16] Maximum number tiles to load\n * simultaneously.\n * @property {boolean} [loadTilesWhileAnimating=false] When set to `true`, tiles\n * will be loaded during animations. This may improve the user experience, but\n * can also make animations stutter on devices with slow memory.\n * @property {boolean} [loadTilesWhileInteracting=false] When set to `true`,\n * tiles will be loaded while interacting with the map. This may improve the\n * user experience, but can also make map panning and zooming choppy on devices\n * with slow memory.\n * @property {number} [moveTolerance=1] The minimum distance in pixels the\n * cursor must move to be detected as a map move event instead of a click.\n * Increasing this value can make it easier to click on the map.\n * @property {Collection<import(\"./Overlay.js\").default>|Array<import(\"./Overlay.js\").default>} [overlays]\n * Overlays initially added to the map. By default, no overlays are added.\n * @property {HTMLElement|string} [target] The container for the map, either the\n * element itself or the `id` of the element. If not specified at construction\n * time, {@link module:ol/Map~Map#setTarget} must be called for the map to be\n * rendered.\n * @property {View} [view] The map's view.  No layer sources will be\n * fetched unless this is specified at construction time or through\n * {@link module:ol/Map~Map#setView}.\n */\n\n\n/**\n * @fires import(\"./MapBrowserEvent.js\").MapBrowserEvent\n * @fires import(\"./MapEvent.js\").MapEvent\n * @fires module:ol/render/Event~RenderEvent#postcompose\n * @fires module:ol/render/Event~RenderEvent#precompose\n * @fires module:ol/render/Event~RenderEvent#rendercomplete\n * @api\n */\nclass PluggableMap extends BaseObject {\n\n  /**\n   * @param {MapOptions} options Map options.\n   */\n  constructor(options) {\n\n    super();\n\n    const optionsInternal = createOptionsInternal(options);\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.maxTilesLoading_ = options.maxTilesLoading !== undefined ? options.maxTilesLoading : 16;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.loadTilesWhileAnimating_ =\n        options.loadTilesWhileAnimating !== undefined ?\n          options.loadTilesWhileAnimating : false;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.loadTilesWhileInteracting_ =\n        options.loadTilesWhileInteracting !== undefined ?\n          options.loadTilesWhileInteracting : false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = options.pixelRatio !== undefined ?\n      options.pixelRatio : DEVICE_PIXEL_RATIO;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.animationDelayKey_;\n\n    /**\n     * @private\n     */\n    this.animationDelay_ = function() {\n      this.animationDelayKey_ = undefined;\n      this.renderFrame_.call(this, Date.now());\n    }.bind(this);\n\n    /**\n     * @private\n     * @type {import(\"./transform.js\").Transform}\n     */\n    this.coordinateToPixelTransform_ = createTransform();\n\n    /**\n     * @private\n     * @type {import(\"./transform.js\").Transform}\n     */\n    this.pixelToCoordinateTransform_ = createTransform();\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.frameIndex_ = 0;\n\n    /**\n     * @private\n     * @type {?FrameState}\n     */\n    this.frameState_ = null;\n\n    /**\n     * The extent at the previous 'moveend' event.\n     * @private\n     * @type {import(\"./extent.js\").Extent}\n     */\n    this.previousExtent_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.viewPropertyListenerKey_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.viewChangeListenerKey_ = null;\n\n    /**\n     * @private\n     * @type {Array<import(\"./events.js\").EventsKey>}\n     */\n    this.layerGroupPropertyListenerKeys_ = null;\n\n    /**\n     * @private\n     * @type {!HTMLElement}\n     */\n    this.viewport_ = document.createElement('div');\n    this.viewport_.className = 'ol-viewport' + (TOUCH ? ' ol-touch' : '');\n    this.viewport_.style.position = 'relative';\n    this.viewport_.style.overflow = 'hidden';\n    this.viewport_.style.width = '100%';\n    this.viewport_.style.height = '100%';\n    // prevent page zoom on IE >= 10 browsers\n    this.viewport_.style.msTouchAction = 'none';\n    this.viewport_.style.touchAction = 'none';\n\n    /**\n     * @private\n     * @type {!HTMLElement}\n     */\n    this.overlayContainer_ = document.createElement('div');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.viewport_.appendChild(this.overlayContainer_);\n\n    /**\n     * @private\n     * @type {!HTMLElement}\n     */\n    this.overlayContainerStopEvent_ = document.createElement('div');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = [\n      EventType.CLICK,\n      EventType.DBLCLICK,\n      EventType.MOUSEDOWN,\n      EventType.TOUCHSTART,\n      EventType.MSPOINTERDOWN,\n      MapBrowserEventType.POINTERDOWN,\n      EventType.MOUSEWHEEL,\n      EventType.WHEEL\n    ];\n    for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n      listen(this.overlayContainerStopEvent_, overlayEvents[i], stopPropagation);\n    }\n    this.viewport_.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n     * @private\n     * @type {MapBrowserEventHandler}\n     */\n    this.mapBrowserEventHandler_ = new MapBrowserEventHandler(this, options.moveTolerance);\n    for (const key in MapBrowserEventType) {\n      listen(this.mapBrowserEventHandler_, MapBrowserEventType[key],\n        this.handleMapBrowserEvent, this);\n    }\n\n    /**\n     * @private\n     * @type {HTMLElement|Document}\n     */\n    this.keyboardEventTarget_ = optionsInternal.keyboardEventTarget;\n\n    /**\n     * @private\n     * @type {Array<import(\"./events.js\").EventsKey>}\n     */\n    this.keyHandlerKeys_ = null;\n\n    listen(this.viewport_, EventType.CONTEXTMENU, this.handleBrowserEvent, this);\n    listen(this.viewport_, EventType.WHEEL, this.handleBrowserEvent, this);\n    listen(this.viewport_, EventType.MOUSEWHEEL, this.handleBrowserEvent, this);\n\n    /**\n     * @type {Collection<import(\"./control/Control.js\").default>}\n     * @protected\n     */\n    this.controls = optionsInternal.controls || new Collection();\n\n    /**\n     * @type {Collection<import(\"./interaction/Interaction.js\").default>}\n     * @protected\n     */\n    this.interactions = optionsInternal.interactions || new Collection();\n\n    /**\n     * @type {Collection<import(\"./Overlay.js\").default>}\n     * @private\n     */\n    this.overlays_ = optionsInternal.overlays;\n\n    /**\n     * A lookup of overlays by id.\n     * @private\n     * @type {Object<string, import(\"./Overlay.js\").default>}\n     */\n    this.overlayIdIndex_ = {};\n\n    /**\n     * @type {import(\"./renderer/Map.js\").default}\n     * @private\n     */\n    this.renderer_ = this.createRenderer();\n\n    /**\n     * @type {function(Event)|undefined}\n     * @private\n     */\n    this.handleResize_;\n\n    /**\n     * @private\n     * @type {import(\"./coordinate.js\").Coordinate}\n     */\n    this.focus_ = null;\n\n    /**\n     * @private\n     * @type {!Array<PostRenderFunction>}\n     */\n    this.postRenderFunctions_ = [];\n\n    /**\n     * @private\n     * @type {TileQueue}\n     */\n    this.tileQueue_ = new TileQueue(\n      this.getTilePriority.bind(this),\n      this.handleTileChange_.bind(this));\n\n    /**\n     * Uids of features to skip at rendering time.\n     * @type {Object<string, boolean>}\n     * @private\n     */\n    this.skippedFeatureUids_ = {};\n\n    listen(\n      this, getChangeEventType(MapProperty.LAYERGROUP),\n      this.handleLayerGroupChanged_, this);\n    listen(this, getChangeEventType(MapProperty.VIEW),\n      this.handleViewChanged_, this);\n    listen(this, getChangeEventType(MapProperty.SIZE),\n      this.handleSizeChanged_, this);\n    listen(this, getChangeEventType(MapProperty.TARGET),\n      this.handleTargetChanged_, this);\n\n    // setProperties will trigger the rendering of the map if the map\n    // is \"defined\" already.\n    this.setProperties(optionsInternal.values);\n\n    this.controls.forEach(\n      /**\n       * @param {import(\"./control/Control.js\").default} control Control.\n       * @this {PluggableMap}\n       */\n      (function(control) {\n        control.setMap(this);\n      }).bind(this));\n\n    listen(this.controls, CollectionEventType.ADD,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        event.element.setMap(this);\n      }, this);\n\n    listen(this.controls, CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        event.element.setMap(null);\n      }, this);\n\n    this.interactions.forEach(\n      /**\n       * @param {import(\"./interaction/Interaction.js\").default} interaction Interaction.\n       * @this {PluggableMap}\n       */\n      (function(interaction) {\n        interaction.setMap(this);\n      }).bind(this));\n\n    listen(this.interactions, CollectionEventType.ADD,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        event.element.setMap(this);\n      }, this);\n\n    listen(this.interactions, CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        event.element.setMap(null);\n      }, this);\n\n    this.overlays_.forEach(this.addOverlayInternal_.bind(this));\n\n    listen(this.overlays_, CollectionEventType.ADD,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        this.addOverlayInternal_(/** @type {import(\"./Overlay.js\").default} */ (event.element));\n      }, this);\n\n    listen(this.overlays_, CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        const overlay = /** @type {import(\"./Overlay.js\").default} */ (event.element);\n        const id = overlay.getId();\n        if (id !== undefined) {\n          delete this.overlayIdIndex_[id.toString()];\n        }\n        event.element.setMap(null);\n      }, this);\n\n  }\n\n  /**\n   * @abstract\n   * @return {import(\"./renderer/Map.js\").default} The map renderer\n   */\n  createRenderer() {\n    throw new Error('Use a map type that has a createRenderer method');\n  }\n\n  /**\n   * Add the given control to the map.\n   * @param {import(\"./control/Control.js\").default} control Control.\n   * @api\n   */\n  addControl(control) {\n    this.getControls().push(control);\n  }\n\n  /**\n   * Add the given interaction to the map.\n   * @param {import(\"./interaction/Interaction.js\").default} interaction Interaction to add.\n   * @api\n   */\n  addInteraction(interaction) {\n    this.getInteractions().push(interaction);\n  }\n\n  /**\n   * Adds the given layer to the top of this map. If you want to add a layer\n   * elsewhere in the stack, use `getLayers()` and the methods available on\n   * {@link module:ol/Collection~Collection}.\n   * @param {import(\"./layer/Base.js\").default} layer Layer.\n   * @api\n   */\n  addLayer(layer) {\n    const layers = this.getLayerGroup().getLayers();\n    layers.push(layer);\n  }\n\n  /**\n   * Add the given overlay to the map.\n   * @param {import(\"./Overlay.js\").default} overlay Overlay.\n   * @api\n   */\n  addOverlay(overlay) {\n    this.getOverlays().push(overlay);\n  }\n\n  /**\n   * This deals with map's overlay collection changes.\n   * @param {import(\"./Overlay.js\").default} overlay Overlay.\n   * @private\n   */\n  addOverlayInternal_(overlay) {\n    const id = overlay.getId();\n    if (id !== undefined) {\n      this.overlayIdIndex_[id.toString()] = overlay;\n    }\n    overlay.setMap(this);\n  }\n\n  /**\n   *\n   * @inheritDoc\n   */\n  disposeInternal() {\n    this.mapBrowserEventHandler_.dispose();\n    unlisten(this.viewport_, EventType.CONTEXTMENU, this.handleBrowserEvent, this);\n    unlisten(this.viewport_, EventType.WHEEL, this.handleBrowserEvent, this);\n    unlisten(this.viewport_, EventType.MOUSEWHEEL, this.handleBrowserEvent, this);\n    if (this.handleResize_ !== undefined) {\n      removeEventListener(EventType.RESIZE, this.handleResize_, false);\n      this.handleResize_ = undefined;\n    }\n    if (this.animationDelayKey_) {\n      cancelAnimationFrame(this.animationDelayKey_);\n      this.animationDelayKey_ = undefined;\n    }\n    this.setTarget(null);\n    super.disposeInternal();\n  }\n\n  /**\n   * Detect features that intersect a pixel on the viewport, and execute a\n   * callback with each intersecting feature. Layers included in the detection can\n   * be configured through the `layerFilter` option in `opt_options`.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel.\n   * @param {function(this: S, import(\"./Feature.js\").FeatureLike,\n   *     import(\"./layer/Layer.js\").default): T} callback Feature callback. The callback will be\n   *     called with two arguments. The first argument is one\n   *     {@link module:ol/Feature feature} or\n   *     {@link module:ol/render/Feature render feature} at the pixel, the second is\n   *     the {@link module:ol/layer/Layer layer} of the feature and will be null for\n   *     unmanaged layers. To stop detection, callback functions can return a\n   *     truthy value.\n   * @param {AtPixelOptions=} opt_options Optional options.\n   * @return {T|undefined} Callback result, i.e. the return value of last\n   * callback execution, or the first truthy callback return value.\n   * @template S,T\n   * @api\n   */\n  forEachFeatureAtPixel(pixel, callback, opt_options) {\n    if (!this.frameState_) {\n      return;\n    }\n    const coordinate = this.getCoordinateFromPixel(pixel);\n    opt_options = opt_options !== undefined ? opt_options :\n      /** @type {AtPixelOptions} */ ({});\n    const hitTolerance = opt_options.hitTolerance !== undefined ?\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n    const layerFilter = opt_options.layerFilter !== undefined ?\n      opt_options.layerFilter : TRUE;\n    return this.renderer_.forEachFeatureAtCoordinate(\n      coordinate, this.frameState_, hitTolerance, callback, null,\n      layerFilter, null);\n  }\n\n  /**\n   * Get all features that intersect a pixel on the viewport.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel.\n   * @param {AtPixelOptions=} opt_options Optional options.\n   * @return {Array<import(\"./Feature.js\").FeatureLike>} The detected features or\n   * `null` if none were found.\n   * @api\n   */\n  getFeaturesAtPixel(pixel, opt_options) {\n    let features = null;\n    this.forEachFeatureAtPixel(pixel, function(feature) {\n      if (!features) {\n        features = [];\n      }\n      features.push(feature);\n    }, opt_options);\n    return features;\n  }\n\n  /**\n   * Detect layers that have a color value at a pixel on the viewport, and\n   * execute a callback with each matching layer. Layers included in the\n   * detection can be configured through `opt_layerFilter`.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel.\n   * @param {function(this: S, import(\"./layer/Layer.js\").default, (Uint8ClampedArray|Uint8Array)): T} callback\n   *     Layer callback. This callback will receive two arguments: first is the\n   *     {@link module:ol/layer/Layer layer}, second argument is an array representing\n   *     [R, G, B, A] pixel values (0 - 255) and will be `null` for layer types\n   *     that do not currently support this argument. To stop detection, callback\n   *     functions can return a truthy value.\n   * @param {AtPixelOptions=} opt_options Configuration options.\n   * @return {T|undefined} Callback result, i.e. the return value of last\n   * callback execution, or the first truthy callback return value.\n   * @template S,T\n   * @api\n   */\n  forEachLayerAtPixel(pixel, callback, opt_options) {\n    if (!this.frameState_) {\n      return;\n    }\n    const options = opt_options || /** @type {AtPixelOptions} */ ({});\n    const hitTolerance = options.hitTolerance !== undefined ?\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n    const layerFilter = options.layerFilter || TRUE;\n    return this.renderer_.forEachLayerAtPixel(\n      pixel, this.frameState_, hitTolerance, callback, null, layerFilter, null);\n  }\n\n  /**\n   * Detect if features intersect a pixel on the viewport. Layers included in the\n   * detection can be configured through `opt_layerFilter`.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel.\n   * @param {AtPixelOptions=} opt_options Optional options.\n   * @return {boolean} Is there a feature at the given pixel?\n   * @template U\n   * @api\n   */\n  hasFeatureAtPixel(pixel, opt_options) {\n    if (!this.frameState_) {\n      return false;\n    }\n    const coordinate = this.getCoordinateFromPixel(pixel);\n    opt_options = opt_options !== undefined ? opt_options :\n      /** @type {AtPixelOptions} */ ({});\n    const layerFilter = opt_options.layerFilter !== undefined ? opt_options.layerFilter : TRUE;\n    const hitTolerance = opt_options.hitTolerance !== undefined ?\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n    return this.renderer_.hasFeatureAtCoordinate(\n      coordinate, this.frameState_, hitTolerance, layerFilter, null);\n  }\n\n  /**\n   * Returns the coordinate in view projection for a browser event.\n   * @param {Event} event Event.\n   * @return {import(\"./coordinate.js\").Coordinate} Coordinate.\n   * @api\n   */\n  getEventCoordinate(event) {\n    return this.getCoordinateFromPixel(this.getEventPixel(event));\n  }\n\n  /**\n   * Returns the map pixel position for a browser event relative to the viewport.\n   * @param {Event|TouchEvent} event Event.\n   * @return {import(\"./pixel.js\").Pixel} Pixel.\n   * @api\n   */\n  getEventPixel(event) {\n    const viewportPosition = this.viewport_.getBoundingClientRect();\n    const eventPosition = 'changedTouches' in event ?\n      /** @type {TouchEvent} */ (event).changedTouches[0] :\n      /** @type {MouseEvent} */ (event);\n\n    return [\n      eventPosition.clientX - viewportPosition.left,\n      eventPosition.clientY - viewportPosition.top\n    ];\n  }\n\n  /**\n   * Get the target in which this map is rendered.\n   * Note that this returns what is entered as an option or in setTarget:\n   * if that was an element, it returns an element; if a string, it returns that.\n   * @return {HTMLElement|string|undefined} The Element or id of the Element that the\n   *     map is rendered in.\n   * @observable\n   * @api\n   */\n  getTarget() {\n    return /** @type {HTMLElement|string|undefined} */ (this.get(MapProperty.TARGET));\n  }\n\n  /**\n   * Get the DOM element into which this map is rendered. In contrast to\n   * `getTarget` this method always return an `Element`, or `null` if the\n   * map has no target.\n   * @return {HTMLElement} The element that the map is rendered in.\n   * @api\n   */\n  getTargetElement() {\n    const target = this.getTarget();\n    if (target !== undefined) {\n      return typeof target === 'string' ? document.getElementById(target) : target;\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Get the coordinate for a given pixel.  This returns a coordinate in the\n   * map view projection.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel position in the map viewport.\n   * @return {import(\"./coordinate.js\").Coordinate} The coordinate for the pixel position.\n   * @api\n   */\n  getCoordinateFromPixel(pixel) {\n    const frameState = this.frameState_;\n    if (!frameState) {\n      return null;\n    } else {\n      return applyTransform(frameState.pixelToCoordinateTransform, pixel.slice());\n    }\n  }\n\n  /**\n   * Get the map controls. Modifying this collection changes the controls\n   * associated with the map.\n   * @return {Collection<import(\"./control/Control.js\").default>} Controls.\n   * @api\n   */\n  getControls() {\n    return this.controls;\n  }\n\n  /**\n   * Get the map overlays. Modifying this collection changes the overlays\n   * associated with the map.\n   * @return {Collection<import(\"./Overlay.js\").default>} Overlays.\n   * @api\n   */\n  getOverlays() {\n    return this.overlays_;\n  }\n\n  /**\n   * Get an overlay by its identifier (the value returned by overlay.getId()).\n   * Note that the index treats string and numeric identifiers as the same. So\n   * `map.getOverlayById(2)` will return an overlay with id `'2'` or `2`.\n   * @param {string|number} id Overlay identifier.\n   * @return {import(\"./Overlay.js\").default} Overlay.\n   * @api\n   */\n  getOverlayById(id) {\n    const overlay = this.overlayIdIndex_[id.toString()];\n    return overlay !== undefined ? overlay : null;\n  }\n\n  /**\n   * Get the map interactions. Modifying this collection changes the interactions\n   * associated with the map.\n   *\n   * Interactions are used for e.g. pan, zoom and rotate.\n   * @return {Collection<import(\"./interaction/Interaction.js\").default>} Interactions.\n   * @api\n   */\n  getInteractions() {\n    return this.interactions;\n  }\n\n  /**\n   * Get the layergroup associated with this map.\n   * @return {LayerGroup} A layer group containing the layers in this map.\n   * @observable\n   * @api\n   */\n  getLayerGroup() {\n    return (\n      /** @type {LayerGroup} */ (this.get(MapProperty.LAYERGROUP))\n    );\n  }\n\n  /**\n   * Get the collection of layers associated with this map.\n   * @return {!Collection<import(\"./layer/Base.js\").default>} Layers.\n   * @api\n   */\n  getLayers() {\n    const layers = this.getLayerGroup().getLayers();\n    return layers;\n  }\n\n  /**\n   * Get the pixel for a coordinate.  This takes a coordinate in the map view\n   * projection and returns the corresponding pixel.\n   * @param {import(\"./coordinate.js\").Coordinate} coordinate A map coordinate.\n   * @return {import(\"./pixel.js\").Pixel} A pixel position in the map viewport.\n   * @api\n   */\n  getPixelFromCoordinate(coordinate) {\n    const frameState = this.frameState_;\n    if (!frameState) {\n      return null;\n    } else {\n      return applyTransform(frameState.coordinateToPixelTransform, coordinate.slice(0, 2));\n    }\n  }\n\n  /**\n   * Get the map renderer.\n   * @return {import(\"./renderer/Map.js\").default} Renderer\n   */\n  getRenderer() {\n    return this.renderer_;\n  }\n\n  /**\n   * Get the size of this map.\n   * @return {import(\"./size.js\").Size|undefined} The size in pixels of the map in the DOM.\n   * @observable\n   * @api\n   */\n  getSize() {\n    return (\n      /** @type {import(\"./size.js\").Size|undefined} */ (this.get(MapProperty.SIZE))\n    );\n  }\n\n  /**\n   * Get the view associated with this map. A view manages properties such as\n   * center and resolution.\n   * @return {View} The view that controls this map.\n   * @observable\n   * @api\n   */\n  getView() {\n    return (\n      /** @type {View} */ (this.get(MapProperty.VIEW))\n    );\n  }\n\n  /**\n   * Get the element that serves as the map viewport.\n   * @return {HTMLElement} Viewport.\n   * @api\n   */\n  getViewport() {\n    return this.viewport_;\n  }\n\n  /**\n   * Get the element that serves as the container for overlays.  Elements added to\n   * this container will let mousedown and touchstart events through to the map,\n   * so clicks and gestures on an overlay will trigger {@link module:ol/MapBrowserEvent~MapBrowserEvent}\n   * events.\n   * @return {!HTMLElement} The map's overlay container.\n   */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n   * Get the element that serves as a container for overlays that don't allow\n   * event propagation. Elements added to this container won't let mousedown and\n   * touchstart events through to the map, so clicks and gestures on an overlay\n   * don't trigger any {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n   * @return {!HTMLElement} The map's overlay container that stops events.\n   */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n   * @param {import(\"./Tile.js\").default} tile Tile.\n   * @param {string} tileSourceKey Tile source key.\n   * @param {import(\"./coordinate.js\").Coordinate} tileCenter Tile center.\n   * @param {number} tileResolution Tile resolution.\n   * @return {number} Tile priority.\n   */\n  getTilePriority(tile, tileSourceKey, tileCenter, tileResolution) {\n    // Filter out tiles at higher zoom levels than the current zoom level, or that\n    // are outside the visible extent.\n    const frameState = this.frameState_;\n    if (!frameState || !(tileSourceKey in frameState.wantedTiles)) {\n      return DROP;\n    }\n    if (!frameState.wantedTiles[tileSourceKey][tile.getKey()]) {\n      return DROP;\n    }\n    // Prioritize the highest zoom level tiles closest to the focus.\n    // Tiles at higher zoom levels are prioritized using Math.log(tileResolution).\n    // Within a zoom level, tiles are prioritized by the distance in pixels\n    // between the center of the tile and the focus.  The factor of 65536 means\n    // that the prioritization should behave as desired for tiles up to\n    // 65536 * Math.log(2) = 45426 pixels from the focus.\n    const deltaX = tileCenter[0] - frameState.focus[0];\n    const deltaY = tileCenter[1] - frameState.focus[1];\n    return 65536 * Math.log(tileResolution) +\n        Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;\n  }\n\n  /**\n   * @param {Event} browserEvent Browser event.\n   * @param {string=} opt_type Type.\n   */\n  handleBrowserEvent(browserEvent, opt_type) {\n    const type = opt_type || browserEvent.type;\n    const mapBrowserEvent = new MapBrowserEvent(type, this, browserEvent);\n    this.handleMapBrowserEvent(mapBrowserEvent);\n  }\n\n  /**\n   * @param {MapBrowserEvent} mapBrowserEvent The event to handle.\n   */\n  handleMapBrowserEvent(mapBrowserEvent) {\n    if (!this.frameState_) {\n      // With no view defined, we cannot translate pixels into geographical\n      // coordinates so interactions cannot be used.\n      return;\n    }\n    this.focus_ = mapBrowserEvent.coordinate;\n    mapBrowserEvent.frameState = this.frameState_;\n    const interactionsArray = this.getInteractions().getArray();\n    if (this.dispatchEvent(mapBrowserEvent) !== false) {\n      for (let i = interactionsArray.length - 1; i >= 0; i--) {\n        const interaction = interactionsArray[i];\n        if (!interaction.getActive()) {\n          continue;\n        }\n        const cont = interaction.handleEvent(mapBrowserEvent);\n        if (!cont) {\n          break;\n        }\n      }\n    }\n  }\n\n  /**\n   * @protected\n   */\n  handlePostRender() {\n\n    const frameState = this.frameState_;\n\n    // Manage the tile queue\n    // Image loads are expensive and a limited resource, so try to use them\n    // efficiently:\n    // * When the view is static we allow a large number of parallel tile loads\n    //   to complete the frame as quickly as possible.\n    // * When animating or interacting, image loads can cause janks, so we reduce\n    //   the maximum number of loads per frame and limit the number of parallel\n    //   tile loads to remain reactive to view changes and to reduce the chance of\n    //   loading tiles that will quickly disappear from view.\n    const tileQueue = this.tileQueue_;\n    if (!tileQueue.isEmpty()) {\n      let maxTotalLoading = this.maxTilesLoading_;\n      let maxNewLoads = maxTotalLoading;\n      if (frameState) {\n        const hints = frameState.viewHints;\n        if (hints[ViewHint.ANIMATING]) {\n          maxTotalLoading = this.loadTilesWhileAnimating_ ? 8 : 0;\n          maxNewLoads = 2;\n        }\n        if (hints[ViewHint.INTERACTING]) {\n          maxTotalLoading = this.loadTilesWhileInteracting_ ? 8 : 0;\n          maxNewLoads = 2;\n        }\n      }\n      if (tileQueue.getTilesLoading() < maxTotalLoading) {\n        tileQueue.reprioritize(); // FIXME only call if view has changed\n        tileQueue.loadMoreTiles(maxTotalLoading, maxNewLoads);\n      }\n    }\n    if (frameState && this.hasListener(RenderEventType.RENDERCOMPLETE) && !frameState.animate &&\n        !this.tileQueue_.getTilesLoading() && !getLoading(this.getLayers().getArray())) {\n      this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE, frameState);\n    }\n\n    const postRenderFunctions = this.postRenderFunctions_;\n    for (let i = 0, ii = postRenderFunctions.length; i < ii; ++i) {\n      postRenderFunctions[i](this, frameState);\n    }\n    postRenderFunctions.length = 0;\n  }\n\n  /**\n   * @private\n   */\n  handleSizeChanged_() {\n    this.render();\n  }\n\n  /**\n   * @private\n   */\n  handleTargetChanged_() {\n    // target may be undefined, null, a string or an Element.\n    // If it's a string we convert it to an Element before proceeding.\n    // If it's not now an Element we remove the viewport from the DOM.\n    // If it's an Element we append the viewport element to it.\n\n    let targetElement;\n    if (this.getTarget()) {\n      targetElement = this.getTargetElement();\n    }\n\n    if (this.keyHandlerKeys_) {\n      for (let i = 0, ii = this.keyHandlerKeys_.length; i < ii; ++i) {\n        unlistenByKey(this.keyHandlerKeys_[i]);\n      }\n      this.keyHandlerKeys_ = null;\n    }\n\n    if (!targetElement) {\n      this.renderer_.removeLayerRenderers();\n      removeNode(this.viewport_);\n      if (this.handleResize_ !== undefined) {\n        removeEventListener(EventType.RESIZE, this.handleResize_, false);\n        this.handleResize_ = undefined;\n      }\n    } else {\n      targetElement.appendChild(this.viewport_);\n\n      const keyboardEventTarget = !this.keyboardEventTarget_ ?\n        targetElement : this.keyboardEventTarget_;\n      this.keyHandlerKeys_ = [\n        listen(keyboardEventTarget, EventType.KEYDOWN, this.handleBrowserEvent, this),\n        listen(keyboardEventTarget, EventType.KEYPRESS, this.handleBrowserEvent, this)\n      ];\n\n      if (!this.handleResize_) {\n        this.handleResize_ = this.updateSize.bind(this);\n        window.addEventListener(EventType.RESIZE, this.handleResize_, false);\n      }\n    }\n\n    this.updateSize();\n    // updateSize calls setSize, so no need to call this.render\n    // ourselves here.\n  }\n\n  /**\n   * @private\n   */\n  handleTileChange_() {\n    this.render();\n  }\n\n  /**\n   * @private\n   */\n  handleViewPropertyChanged_() {\n    this.render();\n  }\n\n  /**\n   * @private\n   */\n  handleViewChanged_() {\n    if (this.viewPropertyListenerKey_) {\n      unlistenByKey(this.viewPropertyListenerKey_);\n      this.viewPropertyListenerKey_ = null;\n    }\n    if (this.viewChangeListenerKey_) {\n      unlistenByKey(this.viewChangeListenerKey_);\n      this.viewChangeListenerKey_ = null;\n    }\n    const view = this.getView();\n    if (view) {\n      this.viewport_.setAttribute('data-view', getUid(view));\n      this.viewPropertyListenerKey_ = listen(\n        view, ObjectEventType.PROPERTYCHANGE,\n        this.handleViewPropertyChanged_, this);\n      this.viewChangeListenerKey_ = listen(\n        view, EventType.CHANGE,\n        this.handleViewPropertyChanged_, this);\n    }\n    this.render();\n  }\n\n  /**\n   * @private\n   */\n  handleLayerGroupChanged_() {\n    if (this.layerGroupPropertyListenerKeys_) {\n      this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey);\n      this.layerGroupPropertyListenerKeys_ = null;\n    }\n    const layerGroup = this.getLayerGroup();\n    if (layerGroup) {\n      this.layerGroupPropertyListenerKeys_ = [\n        listen(\n          layerGroup, ObjectEventType.PROPERTYCHANGE,\n          this.render, this),\n        listen(\n          layerGroup, EventType.CHANGE,\n          this.render, this)\n      ];\n    }\n    this.render();\n  }\n\n  /**\n   * @return {boolean} Is rendered.\n   */\n  isRendered() {\n    return !!this.frameState_;\n  }\n\n  /**\n   * Requests an immediate render in a synchronous manner.\n   * @api\n   */\n  renderSync() {\n    if (this.animationDelayKey_) {\n      cancelAnimationFrame(this.animationDelayKey_);\n    }\n    this.animationDelay_();\n  }\n\n  /**\n   * Request a map rendering (at the next animation frame).\n   * @api\n   */\n  render() {\n    if (this.animationDelayKey_ === undefined) {\n      this.animationDelayKey_ = requestAnimationFrame(this.animationDelay_);\n    }\n  }\n\n  /**\n   * Remove the given control from the map.\n   * @param {import(\"./control/Control.js\").default} control Control.\n   * @return {import(\"./control/Control.js\").default|undefined} The removed control (or undefined\n   *     if the control was not found).\n   * @api\n   */\n  removeControl(control) {\n    return this.getControls().remove(control);\n  }\n\n  /**\n   * Remove the given interaction from the map.\n   * @param {import(\"./interaction/Interaction.js\").default} interaction Interaction to remove.\n   * @return {import(\"./interaction/Interaction.js\").default|undefined} The removed interaction (or\n   *     undefined if the interaction was not found).\n   * @api\n   */\n  removeInteraction(interaction) {\n    return this.getInteractions().remove(interaction);\n  }\n\n  /**\n   * Removes the given layer from the map.\n   * @param {import(\"./layer/Base.js\").default} layer Layer.\n   * @return {import(\"./layer/Base.js\").default|undefined} The removed layer (or undefined if the\n   *     layer was not found).\n   * @api\n   */\n  removeLayer(layer) {\n    const layers = this.getLayerGroup().getLayers();\n    return layers.remove(layer);\n  }\n\n  /**\n   * Remove the given overlay from the map.\n   * @param {import(\"./Overlay.js\").default} overlay Overlay.\n   * @return {import(\"./Overlay.js\").default|undefined} The removed overlay (or undefined\n   *     if the overlay was not found).\n   * @api\n   */\n  removeOverlay(overlay) {\n    return this.getOverlays().remove(overlay);\n  }\n\n  /**\n   * @param {number} time Time.\n   * @private\n   */\n  renderFrame_(time) {\n    let viewState;\n\n    const size = this.getSize();\n    const view = this.getView();\n    const extent = createEmpty();\n    const previousFrameState = this.frameState_;\n    /** @type {?FrameState} */\n    let frameState = null;\n    if (size !== undefined && hasArea(size) && view && view.isDef()) {\n      const viewHints = view.getHints(this.frameState_ ? this.frameState_.viewHints : undefined);\n      const layerStatesArray = this.getLayerGroup().getLayerStatesArray();\n      const layerStates = {};\n      for (let i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n        layerStates[getUid(layerStatesArray[i].layer)] = layerStatesArray[i];\n      }\n      viewState = view.getState(this.pixelRatio_);\n      frameState = /** @type {FrameState} */ ({\n        animate: false,\n        coordinateToPixelTransform: this.coordinateToPixelTransform_,\n        extent: extent,\n        focus: this.focus_ ? this.focus_ : viewState.center,\n        index: this.frameIndex_++,\n        layerStates: layerStates,\n        layerStatesArray: layerStatesArray,\n        pixelRatio: this.pixelRatio_,\n        pixelToCoordinateTransform: this.pixelToCoordinateTransform_,\n        postRenderFunctions: [],\n        size: size,\n        skippedFeatureUids: this.skippedFeatureUids_,\n        tileQueue: this.tileQueue_,\n        time: time,\n        usedTiles: {},\n        viewState: viewState,\n        viewHints: viewHints,\n        wantedTiles: {}\n      });\n    }\n\n    if (frameState) {\n      frameState.extent = getForViewAndSize(viewState.center,\n        viewState.resolution, viewState.rotation, frameState.size, extent);\n    }\n\n    this.frameState_ = frameState;\n    this.renderer_.renderFrame(frameState);\n\n    if (frameState) {\n      if (frameState.animate) {\n        this.render();\n      }\n      Array.prototype.push.apply(this.postRenderFunctions_, frameState.postRenderFunctions);\n\n      if (previousFrameState) {\n        const moveStart = !this.previousExtent_ ||\n                    (!isEmpty(this.previousExtent_) &&\n                    !equals(frameState.extent, this.previousExtent_));\n        if (moveStart) {\n          this.dispatchEvent(\n            new MapEvent(MapEventType.MOVESTART, this, previousFrameState));\n          this.previousExtent_ = createOrUpdateEmpty(this.previousExtent_);\n        }\n      }\n\n      const idle = this.previousExtent_ &&\n          !frameState.viewHints[ViewHint.ANIMATING] &&\n          !frameState.viewHints[ViewHint.INTERACTING] &&\n          !equals(frameState.extent, this.previousExtent_);\n\n      if (idle) {\n        this.dispatchEvent(new MapEvent(MapEventType.MOVEEND, this, frameState));\n        clone(frameState.extent, this.previousExtent_);\n      }\n    }\n\n    this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER, this, frameState));\n\n    setTimeout(this.handlePostRender.bind(this), 0);\n\n  }\n\n  /**\n   * Sets the layergroup of this map.\n   * @param {LayerGroup} layerGroup A layer group containing the layers in this map.\n   * @observable\n   * @api\n   */\n  setLayerGroup(layerGroup) {\n    this.set(MapProperty.LAYERGROUP, layerGroup);\n  }\n\n  /**\n   * Set the size of this map.\n   * @param {import(\"./size.js\").Size|undefined} size The size in pixels of the map in the DOM.\n   * @observable\n   * @api\n   */\n  setSize(size) {\n    this.set(MapProperty.SIZE, size);\n  }\n\n  /**\n   * Set the target element to render this map into.\n   * @param {HTMLElement|string|undefined} target The Element or id of the Element\n   *     that the map is rendered in.\n   * @observable\n   * @api\n   */\n  setTarget(target) {\n    this.set(MapProperty.TARGET, target);\n  }\n\n  /**\n   * Set the view for this map.\n   * @param {View} view The view that controls this map.\n   * @observable\n   * @api\n   */\n  setView(view) {\n    this.set(MapProperty.VIEW, view);\n  }\n\n  /**\n   * @param {import(\"./Feature.js\").default} feature Feature.\n   */\n  skipFeature(feature) {\n    this.skippedFeatureUids_[getUid(feature)] = true;\n    this.render();\n  }\n\n  /**\n   * Force a recalculation of the map viewport size.  This should be called when\n   * third-party code changes the size of the map viewport.\n   * @api\n   */\n  updateSize() {\n    const targetElement = this.getTargetElement();\n\n    if (!targetElement) {\n      this.setSize(undefined);\n    } else {\n      const computedStyle = getComputedStyle(targetElement);\n      this.setSize([\n        targetElement.offsetWidth -\n            parseFloat(computedStyle['borderLeftWidth']) -\n            parseFloat(computedStyle['paddingLeft']) -\n            parseFloat(computedStyle['paddingRight']) -\n            parseFloat(computedStyle['borderRightWidth']),\n        targetElement.offsetHeight -\n            parseFloat(computedStyle['borderTopWidth']) -\n            parseFloat(computedStyle['paddingTop']) -\n            parseFloat(computedStyle['paddingBottom']) -\n            parseFloat(computedStyle['borderBottomWidth'])\n      ]);\n    }\n  }\n\n  /**\n   * @param {import(\"./Feature.js\").default} feature Feature.\n   */\n  unskipFeature(feature) {\n    delete this.skippedFeatureUids_[getUid(feature)];\n    this.render();\n  }\n}\n\n\n/**\n * @param {MapOptions} options Map options.\n * @return {MapOptionsInternal} Internal map options.\n */\nfunction createOptionsInternal(options) {\n\n  /**\n   * @type {HTMLElement|Document}\n   */\n  let keyboardEventTarget = null;\n  if (options.keyboardEventTarget !== undefined) {\n    keyboardEventTarget = typeof options.keyboardEventTarget === 'string' ?\n      document.getElementById(options.keyboardEventTarget) :\n      options.keyboardEventTarget;\n  }\n\n  /**\n   * @type {Object<string, *>}\n   */\n  const values = {};\n\n  const layerGroup = options.layers && typeof /** @type {?} */ (options.layers).getLayers === 'function' ?\n    /** @type {LayerGroup} */ (options.layers) : new LayerGroup({layers: /** @type {Collection} */ (options.layers)});\n  values[MapProperty.LAYERGROUP] = layerGroup;\n\n  values[MapProperty.TARGET] = options.target;\n\n  values[MapProperty.VIEW] = options.view !== undefined ?\n    options.view : new View();\n\n  let controls;\n  if (options.controls !== undefined) {\n    if (Array.isArray(options.controls)) {\n      controls = new Collection(options.controls.slice());\n    } else {\n      assert(typeof /** @type {?} */ (options.controls).getArray === 'function',\n        47); // Expected `controls` to be an array or an `import(\"./Collection.js\").Collection`\n      controls = /** @type {Collection} */ (options.controls);\n    }\n  }\n\n  let interactions;\n  if (options.interactions !== undefined) {\n    if (Array.isArray(options.interactions)) {\n      interactions = new Collection(options.interactions.slice());\n    } else {\n      assert(typeof /** @type {?} */ (options.interactions).getArray === 'function',\n        48); // Expected `interactions` to be an array or an `import(\"./Collection.js\").Collection`\n      interactions = /** @type {Collection} */ (options.interactions);\n    }\n  }\n\n  let overlays;\n  if (options.overlays !== undefined) {\n    if (Array.isArray(options.overlays)) {\n      overlays = new Collection(options.overlays.slice());\n    } else {\n      assert(typeof /** @type {?} */ (options.overlays).getArray === 'function',\n        49); // Expected `overlays` to be an array or an `import(\"./Collection.js\").Collection`\n      overlays = options.overlays;\n    }\n  } else {\n    overlays = new Collection();\n  }\n\n  return {\n    controls: controls,\n    interactions: interactions,\n    keyboardEventTarget: keyboardEventTarget,\n    overlays: overlays,\n    values: values\n  };\n\n}\nexport default PluggableMap;\n\n/**\n * @param  {Array<import(\"./layer/Base.js\").default>} layers Layers.\n * @return {boolean} Layers have sources that are still loading.\n */\nfunction getLoading(layers) {\n  for (let i = 0, ii = layers.length; i < ii; ++i) {\n    const layer = layers[i];\n    if (typeof /** @type {?} */ (layer).getLayers === 'function') {\n      return getLoading(/** @type {LayerGroup} */ (layer).getLayers().getArray());\n    } else {\n      const source = /** @type {import(\"./layer/Layer.js\").default} */ (\n        layer).getSource();\n      if (source && source.loading) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n"],"names":["super","const","let"],"mappings":"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"}